import { useEffect, useRef } from "react";

// Pass in chatList Dependency to detect when to call the notification function
function showNotification(text) {
  // Show useless notification, just for testing
  Notification.requestPermission().then((result) => {
    console.log(result);
    if (result === "granted") {
      navigator.serviceWorker.ready.then((reg) => {
        reg.showNotification("NEW TODO Added!", {
          body: text,
          icon: "data:image/jpeg;base64,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",
        });
      });
    }
  });
}

// User Focuses on window, reset the title
const onWindowFocus = () => {
  document.title = "Chat App";
};

// User is not focused on the window and a notification arrives, show notification
const handleNotification = () => {
  //   showNotification("ASDASD");
  document.title = "NEW MESSAGE!!!";
};

const useNotification = (chatList) => {
  useEffect(() => {
    window.addEventListener("focus", onWindowFocus);

    return () => {
      window.removeEventListener("focus", onWindowFocus);
    };
  }, []);

  const firstMount = useRef(true);
  useEffect(() => {
    // First load dont run code and set firstMount to false
    if (firstMount.current) {
      firstMount.current = false;
    }
    // If window is not in focus, set title to indicate a new message
    else if (!document.hasFocus()) {
      handleNotification();
    }
  }, [chatList]);
};

export default useNotification;
